<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Invoice Matching System - Correct Column Mapping</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .file-upload-area {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .file-upload-area:hover {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
        .file-upload-area.dragover {
            border-color: #3182ce;
            background-color: #bee3f8;
        }
        .progress-bar {
            transition: width 0.5s ease-in-out;
        }
        .status-badge {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        .chart-container {
            height: 400px;
        }
        .results-table {
            max-height: 600px;
            overflow-y: auto;
        }
         {
            .no-print { display: none; }
            .results-table { max-height: none; overflow: visible; }
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <div class="gradient-bg text-white py-8 mb-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h1 class="text-4xl font-bold mb-2 flex items-center justify-center">
                    <i class="fas fa-calculator mr-3"></i>
                    Finance Invoice Matching System
                </h1>
                <p class="text-lg opacity-90">Correct Column Mapping • Last 8 Digits Matching • HERMED Filter • Company ID</p>
                <div class="mt-4">
                    <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800 status-badge">
                        <i class="fas fa-check-circle mr-1"></i>
                        System Ready
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 mb-8">
        <!-- File Upload Section -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- PKU CoreTax File -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <i class="fas fa-file-excel text-green-600 text-2xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">PKU CoreTax File</h3>
                </div>
                <div class="file-upload-area rounded-lg p-8 text-center cursor-pointer" id="pkuUploadArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">Drop PKU file here or click to browse</p>
                    <p class="text-sm text-gray-500">Supports .xlsx files</p>
                    <input type="file" id="pkuFile" class="hidden" accept=".xlsx,.xls">
                </div>
                <div id="pkuStatus" class="mt-4 text-sm"></div>
            </div>

            <!-- PRI CoreTax File -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <i class="fas fa-file-excel text-blue-600 text-2xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">PRI CoreTax File</h3>
                </div>
                <div class="file-upload-area rounded-lg p-8 text-center cursor-pointer" id="priUploadArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">Drop PRI file here or click to browse</p>
                    <p class="text-sm text-gray-500">Supports .xlsx files</p>
                    <input type="file" id="priFile" class="hidden" accept=".xlsx,.xls">
                </div>
                <div id="priStatus" class="mt-4 text-sm"></div>
            </div>

            <!-- Invoice Matching Files -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <div class="flex items-center mb-4">
                    <i class="fas fa-files text-purple-600 text-2xl mr-3"></i>
                    <h3 class="text-lg font-semibold text-gray-800">Invoice Matching Files</h3>
                </div>
                <div class="file-upload-area rounded-lg p-8 text-center cursor-pointer" id="invoiceUploadArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">Drop multiple files here or click to browse</p>
                    <p class="text-sm text-gray-500">Supports multiple .xlsx files</p>
                    <input type="file" id="invoiceFiles" class="hidden" accept=".xlsx,.xls" multiple>
                </div>
                <div id="invoiceStatus" class="mt-4 text-sm space-y-1"></div>
            </div>
        </div>

        <!-- Process Button -->
        <div class="text-center mb-8">
            <button id="processBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-8 rounded-lg text-lg transition duration-300 disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-cogs mr-2"></i>
                Process Invoice Matching
            </button>
        </div>

        <!-- Progress Section -->
        <div id="progressSection" class="bg-white rounded-lg shadow-md p-6 mb-8 hidden">
            <div class="flex items-center mb-4">
                <i class="fas fa-spinner fa-spin text-blue-600 text-xl mr-3"></i>
                <h3 class="text-lg font-semibold">Processing Files...</h3>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4 mb-4">
                <div id="progressBar" class="progress-bar bg-blue-600 h-4 rounded-full" style="width: 0%"></div>
            </div>
            <div id="progressText" class="text-sm text-gray-600">Initializing...</div>
        </div>

        <!-- Results Section -->
        <div id="resultsSection" class="hidden">
            <!-- Summary Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2" id="totalRecords">0</div>
                    <div class="text-gray-600 flex items-center justify-center">
                        <i class="fas fa-database mr-2"></i>Total Records
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-green-600 mb-2" id="matchedRecords">0</div>
                    <div class="text-gray-600 flex items-center justify-center">
                        <i class="fas fa-check-circle mr-2"></i>Matched
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-orange-600 mb-2" id="unmatchedRecords">0</div>
                    <div class="text-gray-600 flex items-center justify-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>Unmatched
                    </div>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center">
                    <div class="text-3xl font-bold text-purple-600 mb-2" id="matchRate">0.00%</div>
                    <div class="text-gray-600 flex items-center justify-center">
                        <i class="fas fa-percentage mr-2"></i>Match Rate
                    </div>
                </div>
            </div>

            <!-- Company Breakdown -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-building mr-3 text-blue-600"></i>Company Breakdown
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-purple-50 rounded-lg">
                            <div class="flex items-center">
                                <span class="inline-block w-3 h-3 bg-purple-600 rounded-full mr-3"></span>
                                <span class="font-medium">PKU</span>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold" id="pkuTotal">Records: 0</div>
                                <div class="text-sm text-gray-600" id="pkuUnmatched">Unmatched: 0</div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between p-4 bg-pink-50 rounded-lg">
                            <div class="flex items-center">
                                <span class="inline-block w-3 h-3 bg-pink-600 rounded-full mr-3"></span>
                                <span class="font-medium">PRI</span>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold" id="priTotal">Records: 0</div>
                                <div class="text-sm text-gray-600" id="priUnmatched">Unmatched: 0</div>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="matchingChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="bg-white rounded-lg shadow-md p-6 mb-8 no-print">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-download mr-3 text-green-600"></i>Export Options
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <button id="exportAllBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition duration-300">
                        <i class="fas fa-file-excel mr-2"></i>Export All Unmatched
                    </button>
                    <button id="exportPkuBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition duration-300">
                        <i class="fas fa-file-excel mr-2"></i>Export PKU Only
                    </button>
                    <button id="exportPriBtn" class="bg-pink-600 hover:bg-pink-700 text-white font-medium py-3 px-4 rounded-lg transition duration-300">
                        <i class="fas fa-file-excel mr-2"></i>Export PRI Only
                    </button>
                </div>
            </div>

            <!-- Unmatched Records Table -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h3 class="text-xl font-semibold mb-4 flex items-center">
                    <i class="fas fa-exclamation-triangle mr-3 text-orange-600"></i>Unmatched Records (Requires Follow-up)
                </h3>
                <div class="results-table">
                    <table class="min-w-full">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vendor Name</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">NPWP</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Faktur Pajak</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Harga DPP</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DPP Nilai Lain</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PPN</th>
                                <th class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kode Diganti</th>
                            </tr>
                        </thead>
                        <tbody id="unmatchedTableBody" class="bg-white divide-y divide-gray-200">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let pkuData = [];
        let priData = [];
        let invoiceData = [];
        let unmatchedRecords = [];
        let matchedRecords = [];
        let chart = null;

        // File upload handling
        function setupFileUpload(uploadAreaId, fileInputId, statusId) {
            const uploadArea = document.getElementById(uploadAreaId);
            const fileInput = document.getElementById(fileInputId);
            const status = document.getElementById(statusId);

            uploadArea.addEventListener('click', () => fileInput.click());
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    fileInput.files = files;
                    handleFileUpload(fileInput, status);
                }
            });

            fileInput.addEventListener('change', () => {
                handleFileUpload(fileInput, status);
            });
        }

        function handleFileUpload(fileInput, statusElement) {
            const files = fileInput.files;
            if (files.length === 0) return;

            if (fileInput.id === 'invoiceFiles') {
                // Multiple files
                statusElement.innerHTML = '';
                let totalRecords = 0;
                Array.from(files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const workbook = XLSX.read(e.target.result, {type: 'binary'});
                            const sheetName = workbook.SheetNames[0];
                            const data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {header: 1});
                            const records = data.length - 4; // Assuming header rows
                            totalRecords += records;
                            
                            const fileDiv = document.createElement('div');
                            fileDiv.className = 'flex items-center text-green-600';
                            fileDiv.innerHTML = `<i class="fas fa-check-circle mr-2"></i>File ${index + 1}: ${file.name.substring(0, 30)}... (${records} records)`;
                            statusElement.appendChild(fileDiv);
                        } catch (error) {
                            const errorDiv = document.createElement('div');
                            errorDiv.className = 'flex items-center text-red-600';
                            errorDiv.innerHTML = `<i class="fas fa-exclamation-circle mr-2"></i>Error loading ${file.name}`;
                            statusElement.appendChild(errorDiv);
                        }
                    };
                    reader.readAsBinaryString(file);
                });
            } else {
                // Single file
                const file = files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const workbook = XLSX.read(e.target.result, {type: 'binary'});
                        const sheetName = workbook.SheetNames[0];
                        const data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {header: 1});
                        const records = data.length - 2; // Assuming header rows
                        
                        statusElement.innerHTML = `<div class="flex items-center text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>File uploaded successfully: ${records} records
                        </div>`;
                    } catch (error) {
                        statusElement.innerHTML = `<div class="flex items-center text-red-600">
                            <i class="fas fa-exclamation-circle mr-2"></i>Error loading file
                        </div>`;
                    }
                };
                reader.readAsBinaryString(file);
            }
        }

        // Initialize file uploads
        setupFileUpload('pkuUploadArea', 'pkuFile', 'pkuStatus');
        setupFileUpload('priUploadArea', 'priFile', 'priStatus');
        setupFileUpload('invoiceUploadArea', 'invoiceFiles', 'invoiceStatus');

        // Process matching
        document.getElementById('processBtn').addEventListener('click', async () => {
            const pkuFile = document.getElementById('pkuFile').files[0];
            const priFile = document.getElementById('priFile').files[0];
            const invoiceFiles = document.getElementById('invoiceFiles').files;

            if (!pkuFile || !priFile || invoiceFiles.length === 0) {
                alert('Please upload all required files');
                return;
            }

            document.getElementById('processBtn').disabled = true;
            document.getElementById('progressSection').classList.remove('hidden');
            updateProgress(10, 'Loading PKU CoreTax file...');

            try {
                // Load PKU data
                pkuData = await loadExcelFile(pkuFile, 1); // Header at row 1
                pkuData = pkuData.map(row => ({
                    company: 'PKU',
                    vendorName: row[0] || '', // Column A
                    npwp: row[1] || '', // Column B
                    fakturPajak: row[2] || '', // Column C
                    fakturDate: row[3] || '', // Column D
                    hargaDpp: row[9] || '', // Column J
                    dppNilaiLain: row[10] || '', // Column K
                    ppn: row[11] || '', // Column L
                    kodeDiganti: row[13] || '', // Column N
                    originalRow: row
                }));
                updateProgress(25, 'Loading PRI CoreTax file...');

                // Load PRI data
                priData = await loadExcelFile(priFile, 2); // Header at row 2
                priData = priData.map(row => ({
                    company: 'PRI',
                    vendorName: row[0] || '', // Column A
                    npwp: row[1] || '', // Column B
                    fakturPajak: row[2] || '', // Column C
                    fakturDate: row[3] || '', // Column D
                    hargaDpp: row[9] || '', // Column J
                    dppNilaiLain: row[10] || '', // Column K
                    ppn: row[11] || '', // Column L
                    kodeDiganti: row[13] || '', // Column N
                    originalRow: row
                }));
                updateProgress(50, 'Loading Invoice Matching files...');

                // Load invoice data
                invoiceData = [];
                for (let i = 0; i < invoiceFiles.length; i++) {
                    const fileData = await loadExcelFile(invoiceFiles[i], 3); // Header at row 3
                    invoiceData = invoiceData.concat(fileData);
                    updateProgress(50 + (i + 1) * 15 / invoiceFiles.length, `Processing invoice file ${i + 1}/${invoiceFiles.length}...`);
                }

                updateProgress(70, 'Filtering HERMED records...');

                // Filter out HERMED records
                const combinedCoreData = [...pkuData, ...priData];
                const filteredCoreData = combinedCoreData.filter(record => 
                    !record.vendorName.toUpperCase().includes('HERMED')
                );

                updateProgress(80, 'Matching invoices (last 8 digits)...');

                // Create lookup map for fast matching
                const invoiceLookup = new Map();
                invoiceData.forEach(row => {
                    if (row[10]) { // Column K
                        const cleanNumber = row[10].toString().replace(/[.-]/g, '');
                        if (cleanNumber.length >= 8) {
                            const last8 = cleanNumber.slice(-8);
                            invoiceLookup.set(last8, row);
                        }
                    }
                });

                // Perform matching
                matchedRecords = [];
                unmatchedRecords = [];

                filteredCoreData.forEach(record => {
                    if (record.fakturPajak) {
                        const cleanFaktur = record.fakturPajak.toString().replace(/[.-]/g, '');
                        if (cleanFaktur.length >= 8) {
                            const last8 = cleanFaktur.slice(-8);
                            if (invoiceLookup.has(last8)) {
                                matchedRecords.push(record);
                            } else {
                                unmatchedRecords.push(record);
                            }
                        } else {
                            unmatchedRecords.push(record);
                        }
                    } else {
                        unmatchedRecords.push(record);
                    }
                });

                updateProgress(95, 'Generating reports...');

                // Display results
                displayResults();
                updateProgress(100, 'Processing complete!');

                setTimeout(() => {
                    document.getElementById('progressSection').classList.add('hidden');
                    document.getElementById('resultsSection').classList.remove('hidden');
                }, 1000);

            } catch (error) {
                console.error('Processing error:', error);
                alert('Error processing files: ' + error.message);
            } finally {
                document.getElementById('processBtn').disabled = false;
            }
        });

        function loadExcelFile(file, headerRow) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const workbook = XLSX.read(e.target.result, {type: 'binary'});
                        const sheetName = workbook.SheetNames[0];
                        const data = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName], {header: 1});
                        resolve(data.slice(headerRow)); // Skip header rows
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.readAsBinaryString(file);
            });
        }

        function updateProgress(percent, text) {
            document.getElementById('progressBar').style.width = `${percent}%`;
            document.getElementById('progressText').textContent = text;
        }

        function displayResults() {
            const totalRecords = matchedRecords.length + unmatchedRecords.length;
            const matchRate = totalRecords > 0 ? ((matchedRecords.length / totalRecords) * 100).toFixed(2) : 0;

            // Update summary statistics
            document.getElementById('totalRecords').textContent = totalRecords.toLocaleString();
            document.getElementById('matchedRecords').textContent = matchedRecords.length.toLocaleString();
            document.getElementById('unmatchedRecords').textContent = unmatchedRecords.length.toLocaleString();
            document.getElementById('matchRate').textContent = `${matchRate}%`;

            // Company breakdown
            const pkuRecords = unmatchedRecords.filter(r => r.company === 'PKU');
            const priRecords = unmatchedRecords.filter(r => r.company === 'PRI');
            const pkuTotal = [...matchedRecords, ...unmatchedRecords].filter(r => r.company === 'PKU').length;
            const priTotal = [...matchedRecords, ...unmatchedRecords].filter(r => r.company === 'PRI').length;

            document.getElementById('pkuTotal').textContent = `Records: ${pkuTotal.toLocaleString()}`;
            document.getElementById('pkuUnmatched').textContent = `Unmatched: ${pkuRecords.length.toLocaleString()}`;
            document.getElementById('priTotal').textContent = `Records: ${priTotal.toLocaleString()}`;
            document.getElementById('priUnmatched').textContent = `Unmatched: ${priRecords.length.toLocaleString()}`;

            // Create chart
            createMatchingChart();

            // Populate unmatched table
            populateUnmatchedTable();
        }

        function createMatchingChart() {
            const ctx = document.getElementById('matchingChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Matched', 'Unmatched'],
                    datasets: [{
                        data: [matchedRecords.length, unmatchedRecords.length],
                        backgroundColor: ['#10B981', '#F59E0B'],
                        borderWidth: 2,
                        borderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function populateUnmatchedTable() {
            const tbody = document.getElementById('unmatchedTableBody');
            tbody.innerHTML = '';

            unmatchedRecords.forEach(record => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                row.innerHTML = `
                    <td class="px-3 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${
                            record.company === 'PKU' ? 'bg-purple-100 text-purple-800' : 'bg-pink-100 text-pink-800'
                        }">
                            ${record.company}
                        </span>
                    </td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.vendorName}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.npwp}</td>
                    <td class="px-3 py-4 text-sm font-mono text-gray-900">${record.fakturPajak}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.fakturDate}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.hargaDpp}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.dppNilaiLain}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.ppn}</td>
                    <td class="px-3 py-4 text-sm text-gray-900">${record.kodeDiganti}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Export functions
        document.getElementById('exportAllBtn').addEventListener('click', () => {
            exportToExcel(unmatchedRecords, 'All_Unmatched_Records');
        });

        document.getElementById('exportPkuBtn').addEventListener('click', () => {
            const pkuRecords = unmatchedRecords.filter(r => r.company === 'PKU');
            exportToExcel(pkuRecords, 'PKU_Unmatched_Records');
        });

        document.getElementById('exportPriBtn').addEventListener('click', () => {
            const priRecords = unmatchedRecords.filter(r => r.company === 'PRI');
            exportToExcel(priRecords, 'PRI_Unmatched_Records');
        });

        function exportToExcel(data, filename) {
            const exportData = data.map(record => ({
                'Company': record.company,
                'Vendor Name': record.vendorName,
                'NPWP': record.npwp,
                'Faktur Pajak': record.fakturPajak,
                'Faktur Date': record.fakturDate,
                'Harga DPP': record.hargaDpp,
                'DPP Nilai Lain': record.dppNilaiLain,
                'PPN': record.ppn,
                'Kode Diganti': record.kodeDiganti
            }));

            const ws = XLSX.utils.json_to_sheet(exportData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Unmatched Records');
            
            const today = new Date().toISOString().slice(0, 10);
            XLSX.writeFile(wb, `${filename}_${today}.xlsx`);
        }
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"95486a712f3d06ab","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDlrHxieGB8tEveLVG9L9%2F%2BqK5mFbtELztUDdt%2BdJDmYEguls6s4qZLLzMEO5phHhVXnRi4A00qiHC6ftVHpk7SLMNZsKFZyWIIJE514S4RLLPzb420%2B%2BGYE0bbNn6kjJmkgf1%2BVU%2BsNUFDWzPBNA9RKIGbIxK8g%2FFYOf1uucGB3m3NVstXz3mLjtebYoCGzcw5vi%2BrFQN0padAkC4nXoo6ZL%2FcoOJxWpFda9xUemcTryZPHKgQAY4qA0KodCdwzjsQf%2BOi5bF1V%2F9z2ckQrJEVzi8QkRi2rQEBHkboylllxy3h24N9vCPUJixQUzauQD0mwgCnm%2Bg5sGqSD34W3IJEzRYolpJHBWZAwYCTJpsQoD4%2FJYqMr6UvLnMiCRK%2FLDjyfkEBbj5X08PKyCwpVHUYzABvWAVXDd3EGJ9tkOg3bgJiLs3kmF8zvE6WHEKg%2FcVFx%2BzuDYuNJHFoyQAXzOk5yVr9xUQytSPtb2KuV33SMvtSidswoPDkJGZyDpP9qlvFr%2Bmdr4fuYcaS78Sm8808w%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDlrHxieGB8tEveLVG9L9/+qK5mFbtELztUDdt+dJDmYEguls6s4qZLLzMEO5phHhVXnRi4A00qiHC6ftVHpk7SLMNZsKFZyWIIJE514S4RLLPzb420++GYE0bbNn6kjJmkgf1+VU+sNUFDWzPBNA9RKIGbIxK8g/FYOf1uucGB3m3NVstXz3mLjtebYoCGzcw5vi+rFQN0padAkC4nXoo6ZL/coOJxWpFda9xUemcTryZPHKgQAY4qA0KodCdwzjsQf+Oi5bF1V/9z2ckQrJEVzi8QkRi2rQEBHkboylllxy3h24N9vCPUJixQUzauQD0mwgCnm+g5sGqSD34W3IJEzRYolpJHBWZAwYCTJpsQoD4/JYqMr6UvLnMiCRK/LDjyfkEBbj5X08PKyCwpVHUYzABvWAVXDd3EGJ9tkOg3bgJiLs3kmF8zvE6WHEKg/cVFx+zuDYuNJHFoyQAXzOk5yVr9xUQytSPtb2KuV33SMvtSidswoPDkJGZyDpP9qlvFr+mdr4fuYcaS78Sm8808w=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    