# ğŸ“§ Send All Emails Button - Quick Guide

## âœ… Fixed! Button Now Shows/Hides Automatically

### ğŸ¯ How It Works

The **"Send All Emails"** button is now **smart** - it automatically appears only when you have email mappings!

---

## ğŸ“ Where to Find the Button

The button appears in the **Bulk Actions** section at the top of the results, right next to "Download All Files (ZIP)".

### Visual Layout:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“Š Split Summary                                           â”‚
â”‚  â€¢ Total Suppliers: 3                                       â”‚
â”‚  â€¢ Total Files: 3                                           â”‚
â”‚  â€¢ Processing Date: 20251025                                â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ğŸ“¥ Download All Files    â”‚  â”‚ âœ‰ï¸ Send All Emails    â”‚  â”‚  â† BUTTON IS HERE!
â”‚  â”‚    (ZIP)                 â”‚  â”‚                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ Split Files by Supplier                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ğŸ“„ PT_SUPPLIER_20251025.xlsx                          â”‚ â”‚
â”‚  â”‚  â€¢ Download  â€¢ WA Web  â€¢ WA App  â€¢ Send Email        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Button Visibility Logic

### âœ… Button SHOWS When:
- You upload **both** completed IM file + email mapping file
- After processing, **at least one** supplier has an email address mapped
- The button appears in **purple color** next to "Download All Files (ZIP)"

### âŒ Button HIDDEN When:
- You only upload completed IM file (no email mapping)
- Email mapping file uploaded but no suppliers match
- No email addresses found in the mapping

---

## ğŸ¬ Step-by-Step Example

### Scenario: Upload files with email mapping

**Step 1: Upload Files**
```
âœ… Upload: Completed IM file
âœ… Upload: Email mapping file (with Column A=Supplier, B=Email)
âŒ Upload: WA mapping (optional - not needed for email)
```

**Step 2: Click "Process & Split Files"**
```
Processing... â³
```

**Step 3: After Processing**
```
Results appear!

Bulk Actions:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Download All Files (ZIP) â”‚  â”‚ Send All Emails    â”‚  â† BUTTON APPEARS!
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â†‘
                        Purple button, ready to click!
```

**Step 4: Click "Send All Emails"**
```
Confirmation: "Send 3 emails to suppliers?"
Click OK â†’ Emails sent! âœ…
Notification: "All 3 emails sent successfully!"
```

---

## ğŸ“ What Happens When You Click

### Individual Email Buttons (per file):
```javascript
Click "Send Email" on a file
     â†“
Confirmation: "Send file to supplier@example.com?"
     â†“
Click OK
     â†“
Notification: "Sending email..."
     â†“
Email sent with file attached!
     â†“
Notification: "Email sent successfully!"
```

### Bulk "Send All Emails" Button:
```javascript
Click "Send All Emails"
     â†“
Confirmation: "Send 10 emails to suppliers?"
     â†“
Click OK
     â†“
Notification: "Sending 10 emails..."
     â†“
API processes all emails in batch
     â†“
Notification: "All 10 emails sent successfully!"
          OR
Notification: "Sent 8 emails, 2 failed" (with details in console)
```

---

## ğŸ› ï¸ Troubleshooting

### Problem: Button doesn't appear after processing

**Check:**
1. âœ… Did you upload email mapping file?
   - If no â†’ Upload it and process again

2. âœ… Does email mapping file have correct format?
   - Column A: Supplier name (exactly as in IM file)
   - Column B: Email address
   - Row 1: Headers (skipped)
   - Row 2+: Data

3. âœ… Do supplier names match?
   - Open IM file â†’ Check supplier names in Column D
   - Open email mapping â†’ Check Column A matches exactly
   - Example: "PT. MARGA NUSANTARA JAYA" must match exactly

4. âœ… Check browser console for errors:
   - Press F12 â†’ Console tab
   - Look for error messages

### Problem: Button shows but nothing happens when clicked

**Check:**
1. âœ… Is email configured on server?
   - Environment variables set: `SENDER_EMAIL` and `SENDER_PASSWORD`
   - Backend API running on port 5002
   - Check API console for error messages

2. âœ… Error message: "Email not configured"?
   - Solution: Set environment variables
   ```bash
   export SENDER_EMAIL="your-email@gmail.com"
   export SENDER_PASSWORD="your-app-password"
   python3 finance/im-splitter.py
   ```

3. âœ… Error message: "Authentication failed"?
   - Solution: Use Gmail App Password (not regular password)
   - Generate at: https://myaccount.google.com/apppasswords

---

## ğŸ’¡ Tips

### Tip 1: Test with One Supplier First
```
1. Create test email mapping with just 1 supplier
2. Upload and process
3. Click individual "Send Email" button
4. Verify email received
5. Then use "Send All Emails" for bulk sending
```

### Tip 2: Check Email Status
```
After clicking "Send All Emails":
- Green notification = All sent âœ…
- Orange notification = Some failed âš ï¸
- Red notification = Error occurred âŒ

For failed emails:
- Press F12 â†’ Console tab
- Look for "Failed emails:" log
- Shows which emails failed and why
```

### Tip 3: Button Visibility
```
The button is SMART:
- Uploaded email mapping? â†’ Button shows âœ…
- No email mapping? â†’ Button hidden âŒ
- Partial mapping? â†’ Button shows for mapped suppliers only âœ…
```

---

## ğŸ¨ Button Styling

**Color:** Purple (`bg-purple-600`)  
**Size:** Same as "Download All Files" button  
**Icon:** âœ‰ï¸ Envelope icon  
**Text:** "Send All Emails"  
**Location:** Top section, right side, next to Download button

---

## âœ… Quick Checklist

Before expecting to see the button:

- [ ] Uploaded completed IM file âœ…
- [ ] Uploaded email mapping file âœ…
- [ ] Email mapping has correct format (Column A=Supplier, B=Email) âœ…
- [ ] Supplier names in mapping match IM file âœ…
- [ ] Clicked "Process & Split Files" âœ…
- [ ] Wait for processing to complete âœ…
- [ ] Look at top section â†’ "Send All Emails" button should appear! âœ…

---

## ğŸ”— Related Documentation

- **Email Setup:** See `EMAIL_FEATURE_SUMMARY.md`
- **Gmail App Password:** https://support.google.com/accounts/answer/185833
- **PV Splitter Reference:** `finance/pv-splitter.py` (same email system)

---

## ğŸ¯ Summary

**The "Send All Emails" button:**
- âœ… EXISTS in the code
- âœ… Located at top of results section
- âœ… Next to "Download All Files (ZIP)" button
- âœ… Purple color, easy to see
- âœ… Shows automatically when email mappings exist
- âœ… Hides automatically when no email mappings
- âœ… One click sends to all suppliers with email addresses
- âœ… Confirmation dialog before sending
- âœ… Progress notifications
- âœ… Success/failure reporting

**If you don't see it:**
1. Check if email mapping file was uploaded
2. Check if suppliers in mapping match IM file
3. Check browser console for errors
4. Verify button is in top section (not bottom with individual files)

**The button is there and working! Just make sure to upload the email mapping file.** ğŸš€
