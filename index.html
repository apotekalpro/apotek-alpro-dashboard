<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apotek Alpro - Executive Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .medical-pattern {
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M30 30c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20zm0 20c0-11.046-8.954-20-20-20s-20 8.954-20 20 8.954 20 20 20 20-8.954 20-20z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-button {
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background-color: #3B82F6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .subtab-button {
            transition: all 0.2s ease;
        }
        
        .subtab-button.active {
            background-color: #1D4ED8;
            color: white;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        
        .login-card {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        
        .iframe-container {
            position: relative;
            width: 100%;
            height: 600px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .iframe-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }
        
        .role-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
        }
        
        .role-admin { background-color: #DC2626; color: white; }
        .role-chief { background-color: #7C3AED; color: white; }
        .role-ppm { background-color: #059669; color: white; }
        .role-finance { background-color: #D97706; color: white; }
        .role-operations { background-color: #0891B2; color: white; }
        .role-bpt { background-color: #DC2626; color: white; }
        .role-academy { background-color: #9333EA; color: white; }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen gradient-bg medical-pattern flex items-center justify-center p-4">
        <div class="login-card rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="bg-blue-100 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-hospital text-blue-600 text-2xl"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-900 mb-2">Apotek Alpro</h1>
                <p class="text-gray-600">Executive Dashboard</p>
            </div>
            
            <form id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user mr-2"></i>Email/Username
                        </label>
                        <input 
                            type="text" 
                            id="username" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your email or username"
                        >
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-lock mr-2"></i>Password
                        </label>
                        <input 
                            type="password" 
                            id="password" 
                            required
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            placeholder="Enter your password"
                        >
                    </div>
                    
                    <button 
                        type="submit" 
                        id="loginBtn"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-4 rounded-lg transition duration-300"
                    >
                        <i class="fas fa-sign-in-alt mr-2"></i>Login
                    </button>
                </div>
            </form>
            
            <div id="loginError" class="mt-4 text-red-600 text-sm hidden">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                <span id="errorMessage">Invalid credentials. Please try again.</span>
            </div>
            
            <div id="loginLoading" class="mt-4 text-blue-600 text-sm text-center hidden">
                <i class="fas fa-spinner fa-spin mr-2"></i>
                Validating credentials...
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <div class="bg-blue-100 w-10 h-10 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-hospital text-blue-600"></i>
                        </div>
                        <div>
                            <h1 class="text-xl font-semibold text-gray-900">Apotek Alpro</h1>
                            <p class="text-sm text-gray-600">Executive Dashboard</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div id="userInfo" class="flex items-center space-x-2">
                            <span id="userRole" class="role-badge"></span>
                            <span id="userName" class="text-sm font-medium text-gray-700"></span>
                        </div>
                        <button id="logoutBtn" class="text-gray-600 hover:text-gray-900 p-2 rounded-lg hover:bg-gray-100">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="bg-white border-b border-gray-200">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex space-x-1" id="mainTabs">
                    <!-- Tabs will be dynamically generated based on user role -->
                </nav>
            </div>
        </div>

        <!-- Tab Content -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- Overview Tab -->
            <div id="overview-content" class="tab-content">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-green-100 p-3 rounded-full">
                                <i class="fas fa-chart-line text-green-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Total Revenue</p>
                                <p class="text-2xl font-semibold text-gray-900">Rp 2.4M</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-blue-100 p-3 rounded-full">
                                <i class="fas fa-users text-blue-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Active Staff</p>
                                <p class="text-2xl font-semibold text-gray-900">156</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-purple-100 p-3 rounded-full">
                                <i class="fas fa-pills text-purple-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Products</p>
                                <p class="text-2xl font-semibold text-gray-900">1,234</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl shadow-sm p-6 card-hover">
                        <div class="flex items-center">
                            <div class="bg-orange-100 p-3 rounded-full">
                                <i class="fas fa-store text-orange-600 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <p class="text-sm text-gray-600">Branches</p>
                                <p class="text-2xl font-semibold text-gray-900">12</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Welcome to Apotek Alpro Executive Dashboard</h3>
                    <p class="text-gray-600 mb-4">Your centralized platform for monitoring all departmental operations and performance metrics.</p>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="border border-gray-200 rounded-lg p-4">
                            <i class="fas fa-shield-alt text-green-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold text-gray-900">Secure Access</h4>
                            <p class="text-sm text-gray-600">Role-based access control ensures data security</p>
                        </div>
                        <div class="border border-gray-200 rounded-lg p-4">
                            <i class="fas fa-clock text-blue-600 text-2xl mb-2"></i>
                            <h4 class="font-semibold text-gray-900">Real-time Data</h4>
                            <p class="text-sm text-gray-600">Live updates from all connected systems</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PPM Tab -->
            <div id="ppm-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="fas fa-chart-bar mr-2 text-green-600"></i>PPM Dashboard
                        </h3>
                        <div class="flex space-x-2">
                            <button onclick="refreshPPM()" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                                <i class="fas fa-sync-alt mr-1"></i>Refresh
                            </button>
                            <a href="https://script.google.com/macros/s/AKfycbzaRaZPlsmOGgKRGssxuMPvYx9FQabDshXkwkfkJyIpoZQ4OHz7TYr7wtccK2DAnlho/exec" 
                               target="_blank" 
                               class="px-3 py-1 bg-blue-600 hover:bg-blue-700 text-white rounded-lg text-sm">
                                <i class="fas fa-external-link-alt mr-1"></i>Open in New Tab
                            </a>
                        </div>
                    </div>
                    
                    <div class="iframe-container">
                        <div class="iframe-loading">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                                <p class="text-gray-600">Loading PPM Dashboard...</p>
                            </div>
                        </div>
                        <iframe 
                            id="ppmFrame"
                            src="https://script.google.com/macros/s/AKfycbzaRaZPlsmOGgKRGssxuMPvYx9FQabDshXkwkfkJyIpoZQ4OHz7TYr7wtccK2DAnlho/exec"
                            width="100%" 
                            height="100%" 
                            frameborder="0"
                            onload="hideLoading('ppmFrame')"
                        ></iframe>
                    </div>
                </div>
            </div>

            <!-- Finance Tab -->
            <div id="finance-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm">
                    <!-- Finance Sub-navigation -->
                    <div class="border-b border-gray-200 px-6 pt-6">
                        <nav class="flex space-x-1" id="financeSubTabs">
                            <button class="subtab-button px-4 py-2 text-sm font-medium rounded-lg bg-blue-600 text-white" 
                                    onclick="showFinanceSubTab('coretax')">
                                <i class="fas fa-file-invoice mr-2"></i>Coretax - Invoice Matching System
                            </button>
                            <button class="subtab-button px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100" 
                                    onclick="showFinanceSubTab('reports')">
                                <i class="fas fa-chart-pie mr-2"></i>Financial Reports
                            </button>
                            <button class="subtab-button px-4 py-2 text-sm font-medium rounded-lg text-gray-600 hover:text-gray-900 hover:bg-gray-100" 
                                    onclick="showFinanceSubTab('budget')">
                                <i class="fas fa-calculator mr-2"></i>Budget Planning
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Finance Sub-content -->
                    <div class="p-6">
                        <!-- Coretax Invoice Matching System -->
                        <div id="finance-coretax" class="finance-subcontent">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-lg font-semibold text-gray-900">
                                    <i class="fas fa-file-invoice mr-2 text-orange-600"></i>Coretax - Invoice Matching System
                                </h3>
                                <div class="flex space-x-2">
                                    <button onclick="refreshCoretax()" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm">
                                        <i class="fas fa-sync-alt mr-1"></i>Refresh
                                    </button>
                                    <a href="https://bsnpklin.gensparkspace.com/" 
                                       target="_blank" 
                                       class="px-3 py-1 bg-orange-600 hover:bg-orange-700 text-white rounded-lg text-sm">
                                        <i class="fas fa-external-link-alt mr-1"></i>Open in New Tab
                                    </a>
                                </div>
                            </div>
                            
                            <div class="iframe-container">
                                <div class="iframe-loading">
                                    <div class="flex flex-col items-center">
                                        <i class="fas fa-spinner fa-spin text-4xl text-orange-600 mb-4"></i>
                                        <p class="text-gray-600">Loading Coretax System...</p>
                                    </div>
                                </div>
                                <iframe 
                                    id="coretaxFrame"
                                    src="https://bsnpklin.gensparkspace.com/"
                                    width="100%" 
                                    height="100%" 
                                    frameborder="0"
                                    onload="hideLoading('coretaxFrame')"
                                ></iframe>
                            </div>
                        </div>
                        
                        <!-- Financial Reports -->
                        <div id="finance-reports" class="finance-subcontent hidden">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <i class="fas fa-chart-pie mr-2 text-blue-600"></i>Financial Reports
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <i class="fas fa-file-alt text-green-600 text-2xl mb-2"></i>
                                    <h4 class="font-semibold text-gray-900">Monthly P&L</h4>
                                    <p class="text-sm text-gray-600">Profit & Loss statements</p>
                                    <button class="mt-2 text-blue-600 hover:text-blue-800 text-sm">View Report →</button>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <i class="fas fa-balance-scale text-blue-600 text-2xl mb-2"></i>
                                    <h4 class="font-semibold text-gray-900">Balance Sheet</h4>
                                    <p class="text-sm text-gray-600">Asset and liability overview</p>
                                    <button class="mt-2 text-blue-600 hover:text-blue-800 text-sm">View Report →</button>
                                </div>
                                <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition-shadow">
                                    <i class="fas fa-money-bill-wave text-purple-600 text-2xl mb-2"></i>
                                    <h4 class="font-semibold text-gray-900">Cash Flow</h4>
                                    <p class="text-sm text-gray-600">Cash flow analysis</p>
                                    <button class="mt-2 text-blue-600 hover:text-blue-800 text-sm">View Report →</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Budget Planning -->
                        <div id="finance-budget" class="finance-subcontent hidden">
                            <h3 class="text-lg font-semibold text-gray-900 mb-4">
                                <i class="fas fa-calculator mr-2 text-purple-600"></i>Budget Planning
                            </h3>
                            <div class="space-y-4">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Annual Budget Overview</h4>
                                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Allocated</p>
                                            <p class="text-xl font-semibold text-blue-600">Rp 12.5M</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Spent</p>
                                            <p class="text-xl font-semibold text-orange-600">Rp 8.2M</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Remaining</p>
                                            <p class="text-xl font-semibold text-green-600">Rp 4.3M</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="text-sm text-gray-600">Utilization</p>
                                            <p class="text-xl font-semibold text-purple-600">65.6%</p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="border border-gray-200 rounded-lg p-4">
                                    <h4 class="font-semibold text-gray-900 mb-2">Department Budget Status</h4>
                                    <div class="space-y-2">
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Operations</span>
                                            <div class="flex items-center space-x-2">
                                                <div class="w-24 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 70%"></div>
                                                </div>
                                                <span class="text-sm font-medium">70%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Marketing</span>
                                            <div class="flex items-center space-x-2">
                                                <div class="w-24 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-green-600 h-2 rounded-full" style="width: 45%"></div>
                                                </div>
                                                <span class="text-sm font-medium">45%</span>
                                            </div>
                                        </div>
                                        <div class="flex justify-between items-center">
                                            <span class="text-sm text-gray-600">Technology</span>
                                            <div class="flex items-center space-x-2">
                                                <div class="w-24 bg-gray-200 rounded-full h-2">
                                                    <div class="bg-orange-600 h-2 rounded-full" style="width: 85%"></div>
                                                </div>
                                                <span class="text-sm font-medium">85%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Operations Tab -->
            <div id="operations-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-cogs mr-2 text-blue-600"></i>Operations Dashboard
                    </h3>
                    <div class="text-center py-12">
                        <i class="fas fa-tools text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600">Operations dashboard will be integrated here</p>
                        <p class="text-gray-500 text-sm">Please provide the Google Apps Script URL for Operations</p>
                    </div>
                </div>
            </div>

            <!-- BPT Tab -->
            <div id="bpt-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-project-diagram mr-2 text-red-600"></i>BPT Dashboard
                    </h3>
                    <div class="text-center py-12">
                        <i class="fas fa-sitemap text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600">BPT dashboard will be integrated here</p>
                        <p class="text-gray-500 text-sm">Please provide the Google Apps Script URL for BPT</p>
                    </div>
                </div>
            </div>

            <!-- Academy Tab -->
            <div id="academy-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">
                        <i class="fas fa-graduation-cap mr-2 text-purple-600"></i>Academy Dashboard
                    </h3>
                    <div class="text-center py-12">
                        <i class="fas fa-book-open text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-600">Academy dashboard will be integrated here</p>
                        <p class="text-gray-500 text-sm">Please provide the Google Apps Script URL for Academy</p>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports-content" class="tab-content">
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-6">
                        <i class="fas fa-chart-bar mr-2 text-green-600"></i>Executive Reports
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div class="border border-gray-200 rounded-lg p-4 card-hover">
                            <i class="fas fa-chart-line text-green-600 text-3xl mb-3"></i>
                            <h4 class="font-semibold text-gray-900 mb-2">Performance Metrics</h4>
                            <p class="text-gray-600 text-sm mb-3">Cross-departmental KPI overview</p>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">View Report →</button>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4 card-hover">
                            <i class="fas fa-users text-blue-600 text-3xl mb-3"></i>
                            <h4 class="font-semibold text-gray-900 mb-2">Staff Analytics</h4>
                            <p class="text-gray-600 text-sm mb-3">Employee performance and attendance</p>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">View Report →</button>
                        </div>
                        
                        <div class="border border-gray-200 rounded-lg p-4 card-hover">
                            <i class="fas fa-money-bill-wave text-purple-600 text-3xl mb-3"></i>
                            <h4 class="font-semibold text-gray-900 mb-2">Financial Summary</h4>
                            <p class="text-gray-600 text-sm mb-3">Revenue, costs, and profitability</p>
                            <button class="text-blue-600 hover:text-blue-800 text-sm font-medium">View Report →</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // User session data
        let currentUser = null;
        let userRole = null;
        
        // Role-based access configuration
        const roleAccess = {
            'admin': ['overview', 'ppm', 'finance', 'operations', 'bpt', 'academy', 'reports'],
            'chief': ['overview', 'ppm', 'finance', 'operations', 'bpt', 'academy', 'reports'],
            'ppm': ['ppm'],
            'finance': ['finance'],
            'operations': ['operations'],
            'bpt': ['bpt'],
            'academy': ['academy']
        };
        
        // Tab configuration
        const tabConfig = {
            'overview': { name: 'Overview', icon: 'fas fa-tachometer-alt' },
            'ppm': { name: 'PPM', icon: 'fas fa-chart-bar' },
            'finance': { name: 'Finance', icon: 'fas fa-dollar-sign' },
            'operations': { name: 'Operations', icon: 'fas fa-cogs' },
            'bpt': { name: 'BPT', icon: 'fas fa-project-diagram' },
            'academy': { name: 'Academy', icon: 'fas fa-graduation-cap' },
            'reports': { name: 'Reports', icon: 'fas fa-chart-line' }
        };
        
        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');
            const loginLoading = document.getElementById('loginLoading');
            
            // Show loading state
            loginBtn.disabled = true;
            loginBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Logging in...';
            loginError.classList.add('hidden');
            loginLoading.classList.remove('hidden');
            
            try {
                // Fetch data from Google Sheets
                const response = await fetch('https://docs.google.com/spreadsheets/d/1_ve_N74hK1KBMk_Rz_jVDRuLn_kDk13FUROkeNKR5P4/export?format=csv');
                const csvData = await response.text();
                
                // Parse CSV data
                const rows = csvData.split('\n').map(row => row.split(','));
                
                // Find user
                let userFound = false;
                for (let i = 1; i < rows.length; i++) { // Skip header row
                    const row = rows[i];
                    if (row.length >= 7) {
                        const email = row[0]?.trim().replace(/"/g, '');
                        const role = row[2]?.trim().replace(/"/g, '');
                        const pass = row[6]?.trim().replace(/"/g, '');
                        
                        if ((email === username || email.split('@')[0] === username) && pass === password) {
                            userFound = true;
                            currentUser = email;
                            userRole = role.toLowerCase();
                            break;
                        }
                    }
                }
                
                if (userFound) {
                    // Successful login
                    loginLoading.classList.add('hidden');
                    showDashboard();
                } else {
                    throw new Error('Invalid credentials');
                }
                
            } catch (error) {
                console.error('Login error:', error);
                loginError.classList.remove('hidden');
                loginLoading.classList.add('hidden');
                document.getElementById('errorMessage').textContent = 'Invalid credentials or connection error. Please try again.';
            }
            
            // Reset button state
            loginBtn.disabled = false;
            loginBtn.innerHTML = '<i class="fas fa-sign-in-alt mr-2"></i>Login';
        });
        
        // Show dashboard after successful login
        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            
            // Update user info
            document.getElementById('userName').textContent = currentUser;
            const roleElement = document.getElementById('userRole');
            roleElement.textContent = userRole.toUpperCase();
            roleElement.className = `role-badge role-${userRole}`;
            
            // Generate navigation tabs based on user role
            generateTabs();
            
            // Show default tab
            const allowedTabs = roleAccess[userRole] || [];
            if (allowedTabs.length > 0) {
                showTab(allowedTabs[0]);
            }
        }
        
        // Generate navigation tabs based on user role
        function generateTabs() {
            const tabsContainer = document.getElementById('mainTabs');
            const allowedTabs = roleAccess[userRole] || [];
            
            tabsContainer.innerHTML = '';
            
            allowedTabs.forEach((tabId, index) => {
                const config = tabConfig[tabId];
                const tabButton = document.createElement('button');
                tabButton.className = `tab-button px-4 py-3 text-sm font-medium rounded-lg transition-all duration-300 ${index === 0 ? 'active' : 'text-gray-600 hover:text-gray-900 hover:bg-gray-100'}`;
                tabButton.onclick = () => showTab(tabId);
                tabButton.innerHTML = `<i class="${config.icon} mr-2"></i>${config.name}`;
                
                tabsContainer.appendChild(tabButton);
            });
        }
        
        // Show specific tab
        function showTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
                button.classList.add('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
            });
            
            // Show selected tab content
            document.getElementById(`${tabId}-content`).classList.add('active');
            
            // Add active class to selected tab button
            event?.target?.classList.add('active');
            event?.target?.classList.remove('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
            
            // If finance tab, show default subtab
            if (tabId === 'finance') {
                showFinanceSubTab('coretax');
            }
        }
        
        // Finance subtab functionality
        function showFinanceSubTab(subTabId) {
            // Hide all finance subcontent
            document.querySelectorAll('.finance-subcontent').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Remove active class from all subtab buttons
            document.querySelectorAll('.subtab-button').forEach(button => {
                button.classList.remove('active', 'bg-blue-600', 'text-white');
                button.classList.add('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
            });
            
            // Show selected subcontent
            document.getElementById(`finance-${subTabId}`).classList.remove('hidden');
            
            // Add active class to selected subtab button
            event?.target?.classList.add('active', 'bg-blue-600', 'text-white');
            event?.target?.classList.remove('text-gray-600', 'hover:text-gray-900', 'hover:bg-gray-100');
        }
        
        // Utility functions
        function refreshPPM() {
            const iframe = document.getElementById('ppmFrame');
            iframe.src = iframe.src;
        }
        
        function refreshCoretax() {
            const iframe = document.getElementById('coretaxFrame');
            iframe.src = iframe.src;
        }
        
        function hideLoading(iframeId) {
            const iframe = document.getElementById(iframeId);
            const container = iframe.parentElement;
            const loading = container.querySelector('.iframe-loading');
            if (loading) {
                loading.style.display = 'none';
            }
        }
        
        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to logout?')) {
                currentUser = null;
                userRole = null;
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                
                // Reset form
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').classList.add('hidden');
            }
        });
        
        // Auto-logout after inactivity (30 minutes)
        let inactivityTimer;
        function resetInactivityTimer() {
            clearTimeout(inactivityTimer);
            inactivityTimer = setTimeout(() => {
                if (currentUser) {
                    alert('Session expired due to inactivity. Please login again.');
                    document.getElementById('logoutBtn').click();
                }
            }, 30 * 60 * 1000); // 30 minutes
        }
        
        // Reset timer on user activity
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('click', resetInactivityTimer);
        
        // Initialize inactivity timer
        resetInactivityTimer();
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9544dd16ccb949ba","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDikLDxaci9C3EsgfVsU%2FtdX68Kle9I6tMczY6RUHycc4hmn7ynTJnt%2FrBCzxm%2B2GgEu1lyd8ltPy%2Fu%2FXzAFlDYKXmgUiBE4tKKwSyZ81i9ElCcsV%2BEksVxIbUD%2B3Qr2MeBR8HsIDI8eaHaS%2B8M06cx%2BQ22TD7rgvyHpLKzl%2BMDdmBn6oPNlsg1V%2F1Pl76FKYhJ2783nKsGbWULQPLxnB%2BYgBouHtqqOInL%2B%2BDQte5NC1bOSfcO7x12WMAbRaWUjHzu1HKjhA2nEWFacPp9%2FoL%2BuS0SSCxL8Szu1kE2z4jdYcbBkzZZZ%2BT2sV3vS5SHLQRvaJVNv2IraIIGHpVy7t2C8UGIs8JUzqg7u1C0tNTOBwOw9zNpYKdBUfO5YOil6qBZruHSFORXXz8axVeBb236uAlpdY%2FpFDK5jCjX070JoBSj1mOIuyX%2Bqvk4Y7CmDaaPtKM%2BxVl9VQMBics2CwlZ1ByW0bWMuQHJ4XI9t%2B5FqZ8TPlvSKQm8S8i9K6XjHPeMKsREHNho3IvyPStbNJBi4%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDikLDxaci9C3EsgfVsU/tdX68Kle9I6tMczY6RUHycc4hmn7ynTJnt/rBCzxm+2GgEu1lyd8ltPy/u/XzAFlDYKXmgUiBE4tKKwSyZ81i9ElCcsV+EksVxIbUD+3Qr2MeBR8HsIDI8eaHaS+8M06cx+Q22TD7rgvyHpLKzl+MDdmBn6oPNlsg1V/1Pl76FKYhJ2783nKsGbWULQPLxnB+YgBouHtqqOInL++DQte5NC1bOSfcO7x12WMAbRaWUjHzu1HKjhA2nEWFacPp9/oL+uS0SSCxL8Szu1kE2z4jdYcbBkzZZZ+T2sV3vS5SHLQRvaJVNv2IraIIGHpVy7t2C8UGIs8JUzqg7u1C0tNTOBwOw9zNpYKdBUfO5YOil6qBZruHSFORXXz8axVeBb236uAlpdY/pFDK5jCjX070JoBSj1mOIuyX+qvk4Y7CmDaaPtKM+xVl9VQMBics2CwlZ1ByW0bWMuQHJ4XI9t+5FqZ8TPlvSKQm8S8i9K6XjHPeMKsREHNho3IvyPStbNJBi4=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    