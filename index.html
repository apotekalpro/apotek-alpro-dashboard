<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apotek Alpro - Executive Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .login-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.2);
        }
        
        .dashboard-container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin: 10px;
            min-height: calc(100vh - 20px);
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            margin: 10px;
            padding: 15px 25px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .tab-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin: 10px;
            padding: 10px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }
        
        .tab-button {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 12px;
            margin: 5px;
            padding: 12px 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-button:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #4F46E5, #7C3AED);
            color: white;
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.4);
            transform: translateY(-2px);
        }
        
        .content-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            margin: 10px;
            padding: 20px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            min-height: calc(100vh - 200px);
        }
        
        .subtab-container {
            background: rgba(248, 250, 252, 0.8);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .subtab-button {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 10px 16px;
            margin: 5px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            transition: all 0.3s ease;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        
        .subtab-button:hover {
            background: rgba(255, 255, 255, 1);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .subtab-button.active {
            background: linear-gradient(135deg, #10B981, #059669);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
        }
        
        .iframe-container {
            width: 100%;
            height: calc(100vh - 280px);
            border: none;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }
        
        .login-form input {
            color: #374151;
            background: rgba(255, 255, 255, 0.9);
        }
        
        .login-form input::placeholder {
            color: #9CA3AF;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #DC2626;
        }
        
        .open-new-tab-btn {
            background: linear-gradient(135deg, #8B5CF6, #A855F7);
            color: white;
            border-radius: 8px;
            padding: 10px 20px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .open-new-tab-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <div id="loginScreen" class="min-h-screen flex items-center justify-center">
        <div class="login-container p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-4xl mb-4">
                    <i class="fas fa-hospital-alt text-blue-600"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Apotek Alpro</h1>
                <p class="text-gray-600">Executive Dashboard</p>
            </div>
            
            <div class="login-form">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email / Username</label>
                    <input type="email" id="email" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Enter your email">
                </div>
                
                <div class="mb-6">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Password</label>
                    <input type="password" id="password" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500" placeholder="Enter your password">
                </div>
                
                <button onclick="login()" class="w-full bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:from-blue-600 hover:to-purple-700 transition duration-300">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                
                <div id="errorMessage" class="error-message mt-4 p-3 rounded-lg hidden">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Invalid credentials. Please check your email and password.
                </div>
            </div>
        </div>
    </div>

    <div id="dashboardScreen" class="hidden">
        <div class="dashboard-container">
            <div class="header flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-hospital-alt text-3xl text-blue-600 mr-3"></i>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-800">Apotek Alpro</h1>
                        <p class="text-gray-600">Executive Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <div class="text-right">
                        <div class="text-sm text-gray-600" id="userEmail"></div>
                        <div class="text-xs text-gray-500">Role: <span id="userRole"></span></div>
                    </div>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-300">
                        <i class="fas fa-sign-out-alt mr-2"></i>Logout
                    </button>
                </div>
            </div>

            <div class="tab-container">
                <div id="tabButtons" class="flex flex-wrap"></div>
            </div>

            <div class="content-container">
                <div id="tabContent"></div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let userData = [];
        
        // Tab configuration
        const tabs = {
            operations: {
                id: 'operations',
                name: 'Operations',
                icon: 'fas fa-cogs',
                roles: ['Admin', 'Chief', 'Operations'],
                url: 'https://script.google.com/macros/s/AKfycbyE1R2ogJa1mJ2GXGFB_cZeiX86H8LbBRiy03Umj6Gr_xnvdlT7KytPhwiLueviYvaXFg/exec',
                title: 'Operations Dashboard',
                description: 'Operational management and monitoring system'
            },
            ppm: {
                id: 'ppm',
                name: 'PPM',
                icon: 'fas fa-chart-line',
                roles: ['Admin', 'Chief', 'PPM'],
                url: 'https://script.google.com/macros/s/AKfycbzaRaZPlsmOGgKRGssxuMPvYx9FQabDshXkwkfkJyIpoZQ4OHz7TYr7wtccK2DAnlho/exec',
                title: 'PPM Dashboard',
                description: 'Project and performance management'
            },
            finance: {
                id: 'finance',
                name: 'Finance',
                icon: 'fas fa-dollar-sign',
                roles: ['Admin', 'Chief', 'Finance'],
                title: 'Finance Dashboard',
                description: 'Financial management and analysis',
                subtabs: {
                    'supplier-gd': {
                        name: 'Supplier Invoice GD Analysis',
                        icon: 'fas fa-industry',
                        url: 'https://script.google.com/macros/s/AKfycbxnxfu8mOtNNyetUbhIXc3VGlAIO_YIKc8jlstv4IIKHJrE5wncT0hO4TCcOgZTsg0cHQ/exec'
                    },
                    'coretax': {
                        name: 'Coretax - Invoice Matching System',
                        icon: 'fas fa-receipt',
                        url: './finance/invoice-matching.html'
                    },
                    'payment-analysis': {
                        name: 'Invoice Matching & Payment Analysis',
                        icon: 'fas fa-credit-card',
                        url: './finance/payment-analysis.html'
                    },
                    'budget': {
                        name: 'Budget Analysis',
                        icon: 'fas fa-chart-pie',
                        url: '#'
                    }
                }
            },
            bpt: {
                id: 'bpt',
                name: 'BPT',
                icon: 'fas fa-target',
                roles: ['Admin', 'Chief', 'BPT'],
                title: 'BPT Dashboard',
                description: 'Business process and technology'
            },
            academy: {
                id: 'academy',
                name: 'Academy',
                icon: 'fas fa-graduation-cap',
                roles: ['Admin', 'Chief', 'Academy'],
                title: 'Academy Dashboard',
                description: 'Training and development'
            },
            reports: {
                id: 'reports',
                name: 'Reports',
                icon: 'fas fa-file-alt',
                roles: ['Admin', 'Chief'],
                title: 'Reports Dashboard',
                description: 'Executive reports and analytics'
            }
        };

        async function login() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!email || !password) {
                showError('Please enter both email and password.');
                return;
            }
            
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/1_ve_N74hK1KBMk_Rz_jVDRuLn_kDk13FUROkeNKR5P4/export?format=csv');
                const csvData = await response.text();
                
                userData = parseCSV(csvData);
                
                const user = userData.find(u => 
                    u.email && u.email.toLowerCase() === email.toLowerCase() && 
                    u.password === password &&
                    u.status && u.status.toLowerCase() === 'active'
                );
                
                if (user) {
                    currentUser = user;
                    showDashboard();
                } else {
                    showError('Invalid credentials. Please check your email and password.');
                }
            } catch (error) {
                console.error('Authentication error:', error);
                showError('Authentication failed. Please try again.');
            }
        }
        
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            const users = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                if (values.length >= headers.length) {
                    users.push({
                        email: values[0],
                        status: values[1],
                        role: values[2],
                        dateAdded: values[3],
                        addedBy: values[4],
                        lastAccess: values[5],
                        password: values[6]
                    });
                }
            }
            
            return users;
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }
        
        function showDashboard() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboardScreen').classList.remove('hidden');
            
            document.getElementById('userEmail').textContent = currentUser.email;
            document.getElementById('userRole').textContent = currentUser.role;
            
            renderTabs();
            
            // Set default tab
            const defaultTab = getDefaultTab();
            if (defaultTab) {
                showTab(defaultTab);
            }
        }
        
        function getDefaultTab() {
            const userRole = currentUser.role;
            
            // Operations first if user has access
            if (tabs.operations.roles.includes(userRole)) {
                return 'operations';
            }
            
            // Find first accessible tab
            for (const [tabId, tab] of Object.entries(tabs)) {
                if (tab.roles && tab.roles.includes(userRole)) {
                    return tabId;
                }
            }
            
            return null;
        }
        
        function renderTabs() {
            const tabButtons = document.getElementById('tabButtons');
            tabButtons.innerHTML = '';
            
            const userRole = currentUser.role;
            
            Object.entries(tabs).forEach(([tabId, tab]) => {
                if (tab.roles && tab.roles.includes(userRole)) {
                    const button = document.createElement('button');
                    button.className = 'tab-button';
                    button.onclick = () => showTab(tabId);
                    button.innerHTML = `
                        <i class="${tab.icon}"></i>
                        ${tab.name}
                    `;
                    button.id = `tab-${tabId}`;
                    tabButtons.appendChild(button);
                }
            });
        }
        
        function showTab(tabId) {
            // Update active tab button
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            const activeButton = document.getElementById(`tab-${tabId}`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            const tab = tabs[tabId];
            const content = document.getElementById('tabContent');
            
            if (tab.subtabs) {
                renderSubtabs(tabId, tab);
            } else {
                renderSingleTab(tab);
            }
        }
        
        function renderSubtabs(tabId, tab) {
            const content = document.getElementById('tabContent');
            const firstSubtab = Object.keys(tab.subtabs)[0];
            
            content.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                        <i class="${tab.icon} mr-3"></i>
                        ${tab.title}
                    </h2>
                    <p class="text-gray-600 mb-4">${tab.description}</p>
                    
                    <div class="subtab-container">
                        <div id="subtabButtons-${tabId}" class="flex flex-wrap mb-4"></div>
                        <div id="subtabContent-${tabId}"></div>
                    </div>
                </div>
            `;
            
            // Render subtab buttons
            const subtabButtons = document.getElementById(`subtabButtons-${tabId}`);
            Object.entries(tab.subtabs).forEach(([subtabId, subtab]) => {
                const button = document.createElement('button');
                button.className = 'subtab-button';
                button.onclick = () => showSubtab(tabId, subtabId);
                button.innerHTML = `
                    <i class="${subtab.icon}"></i>
                    ${subtab.name}
                `;
                button.id = `subtab-${tabId}-${subtabId}`;
                subtabButtons.appendChild(button);
            });
            
            // Show first subtab by default
            showSubtab(tabId, firstSubtab);
        }
        
        function showSubtab(tabId, subtabId) {
            // Update active subtab button
            document.querySelectorAll(`#subtabButtons-${tabId} .subtab-button`).forEach(btn => btn.classList.remove('active'));
            const activeButton = document.getElementById(`subtab-${tabId}-${subtabId}`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            const subtab = tabs[tabId].subtabs[subtabId];
            const content = document.getElementById(`subtabContent-${tabId}`);
            
            renderIframeContent(content, subtab.name, subtab.url, subtab.name);
        }
        
        function renderSingleTab(tab) {
            const content = document.getElementById('tabContent');
            content.innerHTML = `
                <div class="mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2 flex items-center">
                        <i class="${tab.icon} mr-3"></i>
                        ${tab.title}
                    </h2>
                    <p class="text-gray-600 mb-4">${tab.description}</p>
                    <div id="singleTabContent"></div>
                </div>
            `;
            
            const singleContent = document.getElementById('singleTabContent');
            renderIframeContent(singleContent, tab.title, tab.url, tab.name);
        }
        
        function renderIframeContent(container, title, url, systemName) {
            if (!url || url === '#') {
                container.innerHTML = `
                    <div class="text-center py-20">
                        <i class="fas fa-tools text-6xl text-gray-300 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-600 mb-2">Coming Soon</h3>
                        <p class="text-gray-500">This section is under development.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-700">${title}</h3>
                    <button onclick="openInNewTab('${url}')" class="open-new-tab-btn">
                        <i class="fas fa-external-link-alt"></i>
                        Open in New Tab
                    </button>
                </div>
                <div class="iframe-container">
                    <iframe src="${url}" 
                            title="${systemName}"
                            allowfullscreen
                            style="zoom: 1.0; -moz-transform: scale(1.0); -webkit-transform: scale(1.0); transform: scale(1.0);">
                    </iframe>
                </div>
            `;
        }
        
        function openInNewTab(url) {
            window.open(url, '_blank');
        }
        
        function logout() {
            currentUser = null;
            userData = [];
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('dashboardScreen').classList.add('hidden');
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('errorMessage').classList.add('hidden');
        }
        
        // Enter key support for login
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('email').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
            document.getElementById('password').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') login();
            });
        });
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"95547c1edc14f908","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDt62zRfdD%2FLr1%2BP8LGLcPzPOJryKOImhyGAtY230hakc%2BfKkiSPw%2BU8ube14TYIBgNBQbi8tx8QW18IrWStfNV83LHXzbYE1r8tYSBJysv43d1uHRnj3BFx8Xrs1Sd06jBysvpgGnuc8WNHyv5Khjkb3HKtl9plg77XCyttZVQqDTsy2r80NXG4tzfE7y9%2BsRZ9LZDuHMse6h3q%2BSKVnyVashz5mtoLmKUpHBRysSTlFP8r6u8Fe%2FrPQEk07hNkQZrDMkUU6oX5n1pmDZL3%2Fy45vlVGNyM2q54BY87DdTD3i5PpU7wwLPn0KtIdsDwbAxVc3MdNVGnE9kLfScmYFwp%2BaIAsGCcBSYqUL%2FAWXMQA8O4QmNdj%2FXOHv0SRGHZPdXCyao1JI%2BaKdm%2FqJAKdPXs6gpzI8TiXPv1zPfWOi1izIm6Aa2q%2FZDAOb08yA%2F9kq7QRB%2FhMQQficbkEpmCjepFDKYJNNBs%2FopMaHw%2BGSCQlb%2F0kA9xnxgPFIEOMe5FFOoI%2Bi%2FYjkpMJnsX20GEXceEs%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDt62zRfdD/Lr1+P8LGLcPzPOJryKOImhyGAtY230hakc+fKkiSPw+U8ube14TYIBgNBQbi8tx8QW18IrWStfNV83LHXzbYE1r8tYSBJysv43d1uHRnj3BFx8Xrs1Sd06jBysvpgGnuc8WNHyv5Khjkb3HKtl9plg77XCyttZVQqDTsy2r80NXG4tzfE7y9+sRZ9LZDuHMse6h3q+SKVnyVashz5mtoLmKUpHBRysSTlFP8r6u8Fe/rPQEk07hNkQZrDMkUU6oX5n1pmDZL3/y45vlVGNyM2q54BY87DdTD3i5PpU7wwLPn0KtIdsDwbAxVc3MdNVGnE9kLfScmYFwp+aIAsGCcBSYqUL/AWXMQA8O4QmNdj/XOHv0SRGHZPdXCyao1JI+aKdm/qJAKdPXs6gpzI8TiXPv1zPfWOi1izIm6Aa2q/ZDAOb08yA/9kq7QRB/hMQQficbkEpmCjepFDKYJNNBs/opMaHw+GSCQlb/0kA9xnxgPFIEOMe5FFOoI+i/YjkpMJnsX20GEXceEs=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    