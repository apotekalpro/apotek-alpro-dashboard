<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apotek Alpro - Executive Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .subtab-content { display: none; }
        .subtab-content.active { display: block; }
        .medical-gradient { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .success-gradient { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .warning-gradient { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .iframe-container { width: 100%; height: 70vh; border: none; border-radius: 8px; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .role-badge { background: linear-gradient(45deg, #4facfe, #00f2fe); }
        .login-container { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .card-shadow { box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .tab-button { transition: all 0.3s ease; }
        .tab-button:hover { transform: translateY(-2px); }
        .tab-button.active { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .subtab-button { transition: all 0.2s ease; }
        .subtab-button.active { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center login-container">
        <div class="max-w-md w-full mx-4">
            <div class="bg-white rounded-lg shadow-2xl p-8">
                <div class="text-center mb-8">
                    <i class="fas fa-hospital-alt text-4xl text-blue-600 mb-4"></i>
                    <h1 class="text-3xl font-bold text-gray-800">Apotek Alpro</h1>
                    <p class="text-gray-600 mt-2">Executive Dashboard</p>
                </div>
                
                <form id="loginForm" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user mr-2"></i>Email / Username
                        </label>
                        <input type="text" id="loginEmail" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-lock mr-2"></i>Password
                        </label>
                        <input type="password" id="loginPassword" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-200">
                    </div>
                    
                    <button type="submit" id="loginBtn" 
                            class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                        <span id="loginBtnText">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login
                        </span>
                        <span id="loginSpinner" class="hidden">
                            <i class="fas fa-spinner loading-spinner mr-2"></i>Authenticating...
                        </span>
                    </button>
                </form>
                
                <div id="loginError" class="hidden mt-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded-lg">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    <span id="loginErrorText">Invalid credentials. Please try again.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="dashboard" class="hidden min-h-screen bg-gray-50">
        <!-- Header -->
        <header class="bg-white shadow-sm border-b">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center">
                        <i class="fas fa-hospital-alt text-3xl text-blue-600 mr-3"></i>
                        <div>
                            <h1 class="text-2xl font-bold text-gray-900">Apotek Alpro</h1>
                            <p class="text-sm text-gray-600">Executive Dashboard</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-4">
                        <div class="role-badge text-white px-3 py-1 rounded-full text-sm font-medium">
                            <i class="fas fa-user-tag mr-1"></i>
                            <span id="userRole">Admin</span>
                        </div>
                        <div class="text-sm text-gray-600">
                            <span id="userEmail"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b9cccadccbf9dcc1d8d4c9d5dc97dad6d4">[email&#160;protected]</a></span>
                        </div>
                        <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition duration-200">
                            <i class="fas fa-sign-out-alt mr-2"></i>Logout
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <div class="bg-white shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <nav class="flex space-x-1 py-4" id="mainTabs">
                    <!-- Tabs will be dynamically generated based on user role -->
                </nav>
            </div>
        </div>

        <!-- Content Area -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Operations Tab -->
            <div id="operations-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-cogs text-blue-600 mr-3"></i>Operations Dashboard
                        </h2>
                        <button onclick="refreshOperations()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 transition duration-200">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                            <div>
                                <h3 class="font-medium text-blue-800">Operations Management System</h3>
                                <p class="text-sm text-blue-600 mt-1">Comprehensive operations tracking and management dashboard</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="operationsIframeContainer" class="relative">
                        <div id="operationsLoading" class="flex items-center justify-center py-20">
                            <div class="text-center">
                                <i class="fas fa-spinner loading-spinner text-4xl text-blue-500 mb-4"></i>
                                <p class="text-gray-600">Loading Operations Dashboard...</p>
                            </div>
                        </div>
                        
                        <iframe id="operationsIframe" 
                                src="https://script.google.com/macros/s/AKfycbyE1R2ogJa1mJ2GXGFB_cZeiX86H8LbBRiy03Umj6Gr_xnvdlT7KytPhwiLueviYvaXFg/exec"
                                class="iframe-container hidden"
                                onload="hideOperationsLoading()"
                                onerror="showOperationsFallback()">
                        </iframe>
                        
                        <div id="operationsFallback" class="hidden text-center py-20">
                            <i class="fas fa-external-link-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Unable to embed Operations Dashboard</h3>
                            <p class="text-gray-600 mb-6">The dashboard cannot be displayed in this frame due to security restrictions.</p>
                            <a href="https://script.google.com/macros/s/AKfycbyE1R2ogJa1mJ2GXGFB_cZeiX86H8LbBRiy03Umj6Gr_xnvdlT7KytPhwiLueviYvaXFg/exec" 
                               target="_blank" 
                               class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition duration-200 inline-flex items-center">
                                <i class="fas fa-external-link-alt mr-2"></i>Open Operations Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PPM Tab -->
            <div id="ppm-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-project-diagram text-green-600 mr-3"></i>PPM Dashboard
                        </h2>
                        <button onclick="refreshPPM()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition duration-200">
                            <i class="fas fa-sync-alt mr-2"></i>Refresh
                        </button>
                    </div>
                    
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                        <div class="flex items-center">
                            <i class="fas fa-info-circle text-green-600 mr-3"></i>
                            <div>
                                <h3 class="font-medium text-green-800">Project & Portfolio Management</h3>
                                <p class="text-sm text-green-600 mt-1">Track projects, resources, and portfolio performance</p>
                            </div>
                        </div>
                    </div>
                    
                    <div id="ppmIframeContainer" class="relative">
                        <div id="ppmLoading" class="flex items-center justify-center py-20">
                            <div class="text-center">
                                <i class="fas fa-spinner loading-spinner text-4xl text-green-500 mb-4"></i>
                                <p class="text-gray-600">Loading PPM Dashboard...</p>
                            </div>
                        </div>
                        
                        <iframe id="ppmIframe" 
                                src="https://script.google.com/macros/s/AKfycbzaRaZPlsmOGgKRGssxuMPvYx9FQabDshXkwkfkJyIpoZQ4OHz7TYr7wtccK2DAnlho/exec"
                                class="iframe-container hidden"
                                onload="hidePPMLoading()"
                                onerror="showPPMFallback()">
                        </iframe>
                        
                        <div id="ppmFallback" class="hidden text-center py-20">
                            <i class="fas fa-external-link-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Unable to embed PPM Dashboard</h3>
                            <p class="text-gray-600 mb-6">The dashboard cannot be displayed in this frame due to security restrictions.</p>
                            <a href="https://script.google.com/macros/s/AKfycbzaRaZPlsmOGgKRGssxuMPvYx9FQabDshXkwkfkJyIpoZQ4OHz7TYr7wtccK2DAnlho/exec" 
                               target="_blank" 
                               class="bg-green-500 text-white px-6 py-3 rounded-lg hover:bg-green-600 transition duration-200 inline-flex items-center">
                                <i class="fas fa-external-link-alt mr-2"></i>Open PPM Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Finance Tab -->
            <div id="finance-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-800">
                            <i class="fas fa-chart-line text-yellow-600 mr-3"></i>Finance Dashboard
                        </h2>
                    </div>
                    
                    <!-- Finance Sub-tabs -->
                    <div class="border-b border-gray-200 mb-6">
                        <nav class="flex space-x-1" id="financeSubTabs">
                            <button onclick="showFinanceSubTab('coretax')" 
                                    class="subtab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300 active">
                                <i class="fas fa-file-invoice mr-2"></i>Coretax - Invoice Matching
                            </button>
                            <button onclick="showFinanceSubTab('payment-analysis')" 
                                    class="subtab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300">
                                <i class="fas fa-analytics mr-2"></i>Invoice Matching & Payment Analysis
                            </button>
                            <button onclick="showFinanceSubTab('reports')" 
                                    class="subtab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300">
                                <i class="fas fa-chart-bar mr-2"></i>Financial Reports
                            </button>
                            <button onclick="showFinanceSubTab('budget')" 
                                    class="subtab-button px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-800 border-b-2 border-transparent hover:border-gray-300">
                                <i class="fas fa-calculator mr-2"></i>Budget Analysis
                            </button>
                        </nav>
                    </div>
                    
                    <!-- Coretax Sub-tab -->
                    <div id="coretax-subtab" class="subtab-content active">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center">
                                <i class="fas fa-file-invoice text-yellow-600 mr-3"></i>
                                <div>
                                    <h3 class="font-medium text-yellow-800">Coretax Invoice Matching System</h3>
                                    <p class="text-sm text-yellow-600 mt-1">Process and match invoices with tax documents</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center py-20">
                            <i class="fas fa-external-link-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Coretax Invoice Matching System</h3>
                            <p class="text-gray-600 mb-6">Access the complete invoice matching and processing system</p>
                            <a href="./finance/invoice-matching.html" 
                               target="_blank" 
                               class="bg-yellow-500 text-white px-6 py-3 rounded-lg hover:bg-yellow-600 transition duration-200 inline-flex items-center">
                                <i class="fas fa-external-link-alt mr-2"></i>Open Coretax System
                            </a>
                        </div>
                    </div>
                    
                    <!-- Payment Analysis Sub-tab -->
                    <div id="payment-analysis-subtab" class="subtab-content">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 mb-6">
                            <div class="flex items-center">
                                <i class="fas fa-analytics text-purple-600 mr-3"></i>
                                <div>
                                    <h3 class="font-medium text-purple-800">Invoice Matching & Payment Analysis</h3>
                                    <p class="text-sm text-purple-600 mt-1">Comprehensive payment tracking and analysis dashboard</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center py-20">
                            <i class="fas fa-external-link-alt text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Payment Analysis Dashboard</h3>
                            <p class="text-gray-600 mb-6">Access detailed payment analysis and matching tools</p>
                            <a href="./finance/payment-analysis.html" 
                               target="_blank" 
                               class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition duration-200 inline-flex items-center">
                                <i class="fas fa-external-link-alt mr-2"></i>Open Payment Analysis System
                            </a>
                        </div>
                    </div>
                    
                    <!-- Reports Sub-tab -->
                    <div id="reports-subtab" class="subtab-content">
                        <div class="text-center py-20">
                            <i class="fas fa-chart-bar text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Financial Reports</h3>
                            <p class="text-gray-600 mb-6">Comprehensive financial reporting and analytics</p>
                            <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Coming Soon
                            </button>
                        </div>
                    </div>
                    
                    <!-- Budget Sub-tab -->
                    <div id="budget-subtab" class="subtab-content">
                        <div class="text-center py-20">
                            <i class="fas fa-calculator text-4xl text-gray-400 mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-700 mb-2">Budget Analysis</h3>
                            <p class="text-gray-600 mb-6">Budget tracking and financial planning tools</p>
                            <button class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Coming Soon
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- BPT Tab -->
            <div id="bpt-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-users text-purple-600 mr-3"></i>BPT Dashboard
                    </h2>
                    <div class="text-center py-20">
                        <i class="fas fa-users text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Business Process Team</h3>
                        <p class="text-gray-600 mb-6">Team management and process optimization tools</p>
                        <button class="bg-purple-500 text-white px-6 py-3 rounded-lg hover:bg-purple-600 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Coming Soon
                        </button>
                    </div>
                </div>
            </div>

            <!-- Academy Tab -->
            <div id="academy-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-graduation-cap text-red-600 mr-3"></i>Academy Dashboard
                    </h2>
                    <div class="text-center py-20">
                        <i class="fas fa-graduation-cap text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Learning & Development</h3>
                        <p class="text-gray-600 mb-6">Training programs and educational resources</p>
                        <button class="bg-red-500 text-white px-6 py-3 rounded-lg hover:bg-red-600 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Coming Soon
                        </button>
                    </div>
                </div>
            </div>

            <!-- Reports Tab -->
            <div id="reports-tab" class="tab-content">
                <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-chart-pie text-indigo-600 mr-3"></i>Executive Reports
                    </h2>
                    <div class="text-center py-20">
                        <i class="fas fa-chart-pie text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-700 mb-2">Executive Analytics</h3>
                        <p class="text-gray-600 mb-6">Comprehensive executive reporting and insights</p>
                        <button class="bg-indigo-500 text-white px-6 py-3 rounded-lg hover:bg-indigo-600 transition duration-200">
                            <i class="fas fa-plus mr-2"></i>Coming Soon
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
        let currentUser = null;
        let userRole = null;

        // Role-based tab configuration
        const roleTabsConfig = {
            admin: ['operations', 'ppm', 'finance', 'bpt', 'academy', 'reports'],
            chief: ['operations', 'ppm', 'finance', 'bpt', 'academy', 'reports'],
            operations: ['operations'],
            ppm: ['ppm'],
            finance: ['finance'],
            bpt: ['bpt'],
            academy: ['academy']
        };

        const tabConfig = {
            operations: { icon: 'fas fa-cogs', title: 'Operations', color: 'blue' },
            ppm: { icon: 'fas fa-project-diagram', title: 'PPM', color: 'green' },
            finance: { icon: 'fas fa-chart-line', title: 'Finance', color: 'yellow' },
            bpt: { icon: 'fas fa-users', title: 'BPT', color: 'purple' },
            academy: { icon: 'fas fa-graduation-cap', title: 'Academy', color: 'red' },
            reports: { icon: 'fas fa-chart-pie', title: 'Reports', color: 'indigo' }
        };

        // Authentication functions
        async function authenticateUser(email, password) {
            try {
                const response = await fetch('https://docs.google.com/spreadsheets/d/1_ve_N74hK1KBMk_Rz_jVDRuLn_kDk13FUROkeNKR5P4/export?format=csv');
                const csvText = await response.text();
                const lines = csvText.split('\n');
                
                for (let i = 1; i < lines.length; i++) {
                    const columns = lines[i].split(',');
                    if (columns.length >= 7) {
                        const userEmail = columns[0]?.trim().replace(/"/g, '');
                        const userPassword = columns[6]?.trim().replace(/"/g, '');
                        const userRoleData = columns[2]?.trim().replace(/"/g, '');
                        
                        if (userEmail && (userEmail.toLowerCase() === email.toLowerCase()) && userPassword === password) {
                            return {
                                email: userEmail,
                                role: userRoleData.toLowerCase(),
                                success: true
                            };
                        }
                    }
                }
                return { success: false };
            } catch (error) {
                console.error('Authentication error:', error);
                return { success: false };
            }
        }

        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Show loading state
            document.getElementById('loginBtnText').classList.add('hidden');
            document.getElementById('loginSpinner').classList.remove('hidden');
            document.getElementById('loginError').classList.add('hidden');
            
            try {
                const authResult = await authenticateUser(email, password);
                
                if (authResult.success) {
                    currentUser = authResult.email;
                    userRole = authResult.role;
                    
                    // Update user info in dashboard
                    document.getElementById('userEmail').textContent = currentUser;
                    document.getElementById('userRole').textContent = userRole.charAt(0).toUpperCase() + userRole.slice(1);
                    
                    // Generate tabs based on role
                    generateTabs();
                    
                    // Show dashboard
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('dashboard').classList.remove('hidden');
                } else {
                    // Show error
                    document.getElementById('loginError').classList.remove('hidden');
                }
            } catch (error) {
                console.error('Login error:', error);
                document.getElementById('loginError').classList.remove('hidden');
            }
            
            // Hide loading state
            document.getElementById('loginBtnText').classList.remove('hidden');
            document.getElementById('loginSpinner').classList.add('hidden');
        });

        function generateTabs() {
            const allowedTabs = roleTabsConfig[userRole] || [];
            const tabsContainer = document.getElementById('mainTabs');
            tabsContainer.innerHTML = '';
            
            allowedTabs.forEach((tabKey, index) => {
                const config = tabConfig[tabKey];
                const isFirstTab = index === 0;
                
                const tabButton = document.createElement('button');
                tabButton.onclick = () => showTab(tabKey);
                tabButton.className = `tab-button px-6 py-3 text-sm font-medium rounded-lg transition-all duration-200 ${isFirstTab ? 'active text-white' : 'text-gray-600 hover:text-gray-800 bg-gray-100 hover:bg-gray-200'}`;
                tabButton.innerHTML = `<i class="${config.icon} mr-2"></i>${config.title}`;
                
                tabsContainer.appendChild(tabButton);
                
                // Show first tab by default
                if (isFirstTab) {
                    showTab(tabKey);
                }
            });
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Update tab button states
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-gray-600', 'bg-gray-100');
            });
            
            // Highlight active tab button
            event.target.classList.add('active', 'text-white');
            event.target.classList.remove('text-gray-600', 'bg-gray-100');
        }

        function showFinanceSubTab(subtabName) {
            // Hide all finance subtabs
            document.querySelectorAll('.subtab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected subtab
            document.getElementById(subtabName + '-subtab').classList.add('active');
            
            // Update subtab button states
            document.querySelectorAll('.subtab-button').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-gray-600');
            });
            
            // Highlight active subtab button
            event.target.classList.add('active', 'text-white');
            event.target.classList.remove('text-gray-600');
        }

        // Iframe loading functions
        function hideOperationsLoading() {
            document.getElementById('operationsLoading').classList.add('hidden');
            document.getElementById('operationsIframe').classList.remove('hidden');
        }

        function showOperationsFallback() {
            document.getElementById('operationsLoading').classList.add('hidden');
            document.getElementById('operationsIframe').classList.add('hidden');
            document.getElementById('operationsFallback').classList.remove('hidden');
        }

        function hidePPMLoading() {
            document.getElementById('ppmLoading').classList.add('hidden');
            document.getElementById('ppmIframe').classList.remove('hidden');
        }

        function showPPMFallback() {
            document.getElementById('ppmLoading').classList.add('hidden');
            document.getElementById('ppmIframe').classList.add('hidden');
            document.getElementById('ppmFallback').classList.remove('hidden');
        }

        function refreshOperations() {
            document.getElementById('operationsIframe').src = document.getElementById('operationsIframe').src;
        }

        function refreshPPM() {
            document.getElementById('ppmIframe').src = document.getElementById('ppmIframe').src;
        }

        function logout() {
            currentUser = null;
            userRole = null;
            document.getElementById('dashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('loginForm').reset();
        }

        // Auto-detect iframe loading issues
        setTimeout(() => {
            const operationsIframe = document.getElementById('operationsIframe');
            const ppmIframe = document.getElementById('ppmIframe');
            
            if (!operationsIframe.classList.contains('hidden') && operationsIframe.contentDocument === null) {
                showOperationsFallback();
            }
            
            if (!ppmIframe.classList.contains('hidden') && ppmIframe.contentDocument === null) {
                showPPMFallback();
            }
        }, 10000);
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9552bcf1be34a075","serverTiming":{"name":{"cfExtPri":true,"cfEdge":true,"cfOrigin":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"version":"2025.6.2","token":"4edd5f8ec12a48cfa682ab8261b80a79"}' crossorigin="anonymous"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDiT5o%2FUOeD%2BoBuvxhSzEndhD%2F%2Bl2hnEEOCfv0GFpZ5iAX%2B8ofHTCqfAvrb3DVpauHetfYeP6ICcL19kD63RZdDUO5JVYEOg8UoX6VG%2FAxZulCb7V3qTvHL%2FyVu2J8%2Bd%2BZSUPPNHgHzKJ1YpQkjjF7O0miwXPj34x%2Botkf0N404%2BHi1TJR6gLK7zRGSW4rEe%2BolcIClIycmgwI7KgHDW36pSqvn8g5yHSK6km%2Fa95UEeHTB4h3aHIWF5mUqhH%2BCtVSHIDKSjXFqclj4c3mnDfIN6ubzKwncvawyoz7t02%2BtKBlWm3wc%2BD92Xl3HOuQjtnWlWmDPLLG567MHUOJLUu3tbiz9pzBApVJlN9myUGR%2BcAJA9tmXcvkT5FLY9GZQ4Zk8FD2hvgXTVMzSmKngk07vs9hTrLTpI2qxj86m51bHIy2tCa%2FC17x4G16y%2BcnyxizzjDeXQBrQH3LN3yEqhMles%2F1Hqp%2BhaU2EzofyuKzrtXKHMe69Akr3g05KkhaPTaJcleiv7FXQ9JL1bTobY0iog%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDiT5o/UOeD+oBuvxhSzEndhD/+l2hnEEOCfv0GFpZ5iAX+8ofHTCqfAvrb3DVpauHetfYeP6ICcL19kD63RZdDUO5JVYEOg8UoX6VG/AxZulCb7V3qTvHL/yVu2J8+d+ZSUPPNHgHzKJ1YpQkjjF7O0miwXPj34x+otkf0N404+Hi1TJR6gLK7zRGSW4rEe+olcIClIycmgwI7KgHDW36pSqvn8g5yHSK6km/a95UEeHTB4h3aHIWF5mUqhH+CtVSHIDKSjXFqclj4c3mnDfIN6ubzKwncvawyoz7t02+tKBlWm3wc+D92Xl3HOuQjtnWlWmDPLLG567MHUOJLUu3tbiz9pzBApVJlN9myUGR+cAJA9tmXcvkT5FLY9GZQ4Zk8FD2hvgXTVMzSmKngk07vs9hTrLTpI2qxj86m51bHIy2tCa/C17x4G16y+cnyxizzjDeXQBrQH3LN3yEqhMles/1Hqp+haU2EzofyuKzrtXKHMe69Akr3g05KkhaPTaJcleiv7FXQ9JL1bTobY0iog=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    